EESchema Schematic File Version 2  date 10/14/2011 9:55:46 PM
LIBS:power
LIBS:device
LIBS:transistors
LIBS:conn
LIBS:linear
LIBS:regul
LIBS:74xx
LIBS:cmos4000
LIBS:adc-dac
LIBS:memory
LIBS:xilinx
LIBS:special
LIBS:microcontrollers
LIBS:dsp
LIBS:microchip
LIBS:analog_switches
LIBS:motorola
LIBS:texas
LIBS:intel
LIBS:audio
LIBS:interface
LIBS:digital-audio
LIBS:philips
LIBS:display
LIBS:cypress
LIBS:siliconi
LIBS:opto
LIBS:atmel
LIBS:contrib
LIBS:valves
LIBS:PNP
LIBS:MiataPNP-cache
EELAYER 25  0
EELAYER END
$Descr User 17000 11000
encoding utf-8
Sheet 1 8
Title ""
Date "15 oct 2011"
Rev ""
Comp ""
Comment1 ""
Comment2 ""
Comment3 ""
Comment4 ""
$EndDescr
Text Notes 10300 8650 0    60   ~ 0
Knock Processing
Text Notes 14550 8300 0    60   ~ 0
Flyback Control
Text Label 9050 4850 0    60   ~ 0
GND
Connection ~ 9850 4250
Wire Wire Line
	9850 4150 9850 4250
Wire Wire Line
	9850 4250 9850 4350
Wire Wire Line
	9850 4350 9850 4450
Wire Wire Line
	9850 4450 9850 4550
Wire Wire Line
	9850 4550 9850 4850
Connection ~ 9850 4450
Wire Wire Line
	9850 4850 8350 4850
Connection ~ 8350 4450
Connection ~ 8350 4250
Wire Wire Line
	9850 2300 10150 2300
Wire Wire Line
	8350 1300 8100 1300
Wire Wire Line
	12650 1850 12300 1850
Wire Wire Line
	12650 1450 12300 1450
Wire Wire Line
	15200 8100 14650 8100
Connection ~ 15200 7650
Wire Wire Line
	15200 7600 15200 7650
Wire Wire Line
	15200 7650 15200 7700
Wire Wire Line
	14650 8100 14650 7850
Wire Wire Line
	14700 1650 14300 1650
Wire Wire Line
	14700 2250 14300 2250
Wire Wire Line
	14700 1950 14300 1950
Wire Wire Line
	3800 6300 4150 6300
Wire Wire Line
	1600 9200 1350 9200
Wire Wire Line
	3900 9700 4550 9700
Wire Wire Line
	4550 9300 4550 9200
Wire Wire Line
	4550 9200 4550 9100
Wire Wire Line
	3800 7500 4150 7500
Wire Wire Line
	3800 8200 4200 8200
Wire Wire Line
	9850 2800 10150 2800
Wire Wire Line
	10850 2600 11150 2600
Wire Wire Line
	9850 3100 9950 3100
Wire Wire Line
	8450 8200 8100 8200
Wire Wire Line
	9950 8200 9450 8200
Wire Wire Line
	9450 8200 9350 8200
Connection ~ 11800 7500
Wire Wire Line
	9600 7600 9600 7500
Wire Wire Line
	9600 7600 9250 7600
Wire Wire Line
	11300 8300 11600 8300
Wire Wire Line
	11300 8100 11600 8100
Wire Wire Line
	9950 8000 9650 8000
Wire Wire Line
	9250 6900 9250 7200
Wire Wire Line
	11300 7400 11400 7400
Wire Wire Line
	11400 7400 11400 7100
Wire Wire Line
	9800 7600 9800 7100
Wire Wire Line
	9800 7600 9950 7600
Wire Wire Line
	9600 7500 9950 7500
Wire Wire Line
	8350 1900 8100 1900
Wire Wire Line
	8350 1600 8100 1600
Wire Wire Line
	3450 3550 3800 3550
Wire Wire Line
	1900 3500 1500 3500
Wire Wire Line
	1900 3300 1500 3300
Wire Wire Line
	1900 2500 1500 2500
Wire Wire Line
	1900 2300 1500 2300
Wire Wire Line
	1900 1900 1500 1900
Connection ~ 1600 1500
Wire Wire Line
	1600 1500 1600 1700
Wire Wire Line
	1600 1700 1900 1700
Wire Wire Line
	3450 1600 3700 1600
Wire Wire Line
	3450 3350 3800 3350
Wire Wire Line
	3450 4050 3800 4050
Wire Wire Line
	3450 3850 3800 3850
Wire Wire Line
	1900 1300 1750 1300
Wire Wire Line
	1750 1300 1500 1300
Wire Wire Line
	1500 1500 1600 1500
Wire Wire Line
	1600 1500 1900 1500
Wire Wire Line
	1900 1400 1750 1400
Connection ~ 10150 1300
Wire Wire Line
	10150 1150 10150 1300
Wire Wire Line
	10150 1300 10150 1400
Wire Wire Line
	10150 1400 9850 1400
Wire Wire Line
	9850 3800 10150 3800
Wire Wire Line
	9850 2700 10150 2700
Wire Wire Line
	9850 2100 10150 2100
Wire Wire Line
	9850 1700 10150 1700
Wire Wire Line
	9850 2500 10150 2500
Wire Wire Line
	9850 3300 10150 3300
Wire Wire Line
	9850 3400 10150 3400
Wire Wire Line
	9850 1300 10150 1300
Wire Wire Line
	3450 1400 3700 1400
Wire Wire Line
	1900 2600 1500 2600
Connection ~ 1750 1300
Wire Wire Line
	1750 1400 1750 1300
Wire Wire Line
	3450 3650 3800 3650
Wire Wire Line
	3450 4150 3800 4150
Wire Wire Line
	3450 3950 3800 3950
Wire Wire Line
	3450 2700 3800 2700
Wire Wire Line
	1900 1600 1250 1600
Wire Wire Line
	1900 1800 1500 1800
Wire Wire Line
	1900 2000 1500 2000
Wire Wire Line
	1900 2400 1500 2400
Wire Wire Line
	1900 3200 1500 3200
Wire Wire Line
	1900 3400 1500 3400
Wire Wire Line
	3450 3750 3800 3750
Wire Wire Line
	3450 3250 3800 3250
Wire Wire Line
	8350 1800 8100 1800
Wire Wire Line
	8350 2100 8100 2100
Wire Wire Line
	9950 7400 9600 7400
Wire Wire Line
	9800 7100 11400 7100
Wire Wire Line
	11400 7100 12000 7100
Connection ~ 11400 7100
Wire Wire Line
	12400 7100 12750 7100
Wire Wire Line
	9950 8100 9650 8100
Wire Wire Line
	11300 8200 11600 8200
Wire Wire Line
	9250 7200 9600 7200
Wire Wire Line
	9600 7200 9600 7400
Wire Wire Line
	12700 7500 13100 7500
Wire Wire Line
	9450 8300 9450 8200
Connection ~ 9450 8200
Wire Wire Line
	11300 7500 11800 7500
Wire Wire Line
	11800 7500 11800 7600
Wire Wire Line
	10450 3100 10700 3100
Wire Wire Line
	10350 2600 9850 2600
Wire Wire Line
	9850 2900 10150 2900
Wire Wire Line
	3800 7400 4150 7400
Wire Wire Line
	3800 7000 4150 7000
Wire Wire Line
	3800 9100 3900 9100
Wire Wire Line
	3900 9100 3950 9100
Wire Wire Line
	3900 9300 3900 9100
Connection ~ 3900 9100
Wire Wire Line
	3800 9200 4550 9200
Connection ~ 4550 9200
Wire Wire Line
	1600 8800 1350 8800
Wire Wire Line
	1350 8800 1350 9200
Wire Wire Line
	3800 6400 4150 6400
Wire Wire Line
	14700 2100 14300 2100
Wire Wire Line
	14700 1500 14300 1500
Wire Wire Line
	14700 1800 14300 1800
Wire Wire Line
	14700 3200 14300 3200
Wire Wire Line
	14700 2900 14300 2900
Wire Wire Line
	14700 3500 14300 3500
Wire Wire Line
	14700 3350 14300 3350
Wire Wire Line
	14700 3650 14300 3650
Wire Wire Line
	14700 3050 14300 3050
Wire Wire Line
	14700 5850 14300 5850
Wire Wire Line
	14700 6450 14300 6450
Wire Wire Line
	14700 6150 14300 6150
Wire Wire Line
	14700 6300 14300 6300
Wire Wire Line
	14700 5700 14300 5700
Wire Wire Line
	14700 6000 14300 6000
Wire Wire Line
	14700 4600 14300 4600
Wire Wire Line
	14700 4300 14300 4300
Wire Wire Line
	14700 4900 14300 4900
Wire Wire Line
	14700 4750 14300 4750
Wire Wire Line
	14700 5050 14300 5050
Wire Wire Line
	14700 4450 14300 4450
Wire Wire Line
	15200 7650 14950 7650
Wire Wire Line
	15200 7100 14650 7100
Wire Wire Line
	14650 7100 14650 7450
Wire Wire Line
	8350 3600 8100 3600
Wire Wire Line
	8350 3850 8100 3850
Wire Wire Line
	12650 1600 12300 1600
Wire Wire Line
	12650 2000 12300 2000
Wire Wire Line
	12650 3100 12300 3100
Wire Wire Line
	12650 2700 12300 2700
Wire Wire Line
	12650 2550 12300 2550
Wire Wire Line
	12650 2950 12300 2950
Wire Wire Line
	12650 4050 12300 4050
Wire Wire Line
	12650 3650 12300 3650
Wire Wire Line
	12650 3800 12300 3800
Wire Wire Line
	12650 4200 12300 4200
Wire Wire Line
	9850 1900 10150 1900
Connection ~ 8350 4350
Wire Wire Line
	8350 4850 8350 4550
Wire Wire Line
	8350 4550 8350 4450
Wire Wire Line
	8350 4450 8350 4350
Wire Wire Line
	8350 4350 8350 4250
Wire Wire Line
	8350 4250 8350 4150
Connection ~ 8350 4550
Connection ~ 9850 4550
Connection ~ 9850 4350
Text Label 8100 1300 0    60   ~ 0
PA0
Text Label 10150 2300 0    60   ~ 0
WLED
Text Label 10150 1900 0    60   ~ 0
ALED
Text Label 12300 4200 0    60   ~ 0
Purge
Text Label 12300 4050 0    60   ~ 0
WLED
Text Label 12300 3800 0    60   ~ 0
GND
Text Label 12300 3650 0    60   ~ 0
12V
$Sheet
S 12650 3550 550  750 
U 4E98F7A4
F0 "Purge" 60
F1 "Relay.sch" 60
F2 "IN" I L 12650 4050 60 
F3 "12V" B L 12650 3650 60 
F4 "GND" B L 12650 3800 60 
F5 "OUT" O L 12650 4200 60 
$EndSheet
$Sheet
S 12650 2450 550  750 
U 4E98F795
F0 "CEL" 60
F1 "Relay.sch" 60
F2 "IN" I L 12650 2950 60 
F3 "12V" B L 12650 2550 60 
F4 "GND" B L 12650 2700 60 
F5 "OUT" O L 12650 3100 60 
$EndSheet
Text Label 12300 2550 0    60   ~ 0
12V
Text Label 12300 2700 0    60   ~ 0
GND
Text Label 12300 2950 0    60   ~ 0
ALED
Text Label 12300 3100 0    60   ~ 0
CEL
Text Label 12300 2000 0    60   ~ 0
FAN
Text Label 12300 1850 0    60   ~ 0
PA0
Text Label 12300 1600 0    60   ~ 0
GND
Text Label 12300 1450 0    60   ~ 0
12V
$Sheet
S 12650 1350 550  750 
U 4E98F68A
F0 "Fan" 60
F1 "Relay.sch" 60
F2 "IN" I L 12650 1850 60 
F3 "12V" B L 12650 1450 60 
F4 "GND" B L 12650 1600 60 
F5 "OUT" O L 12650 2000 60 
$EndSheet
Text Label 8100 3850 0    60   ~ 0
IGN1
Text Label 8100 3600 0    60   ~ 0
IGN2
Text Label 14800 7100 0    60   ~ 0
FB
Text Label 14750 8100 0    60   ~ 0
GND
$Comp
L DIODESCH D?
U 1 1 4E98EE7B
P 15200 7900
F 0 "D?" H 15200 8000 40  0000 C CNN
F 1 "36V" H 15200 7800 40  0000 C CNN
	1    15200 7900
	0    -1   -1   0   
$EndComp
$Comp
L R R?
U 1 1 4E98EE55
P 15200 7350
F 0 "R?" V 15280 7350 50  0000 C CNN
F 1 "270" V 15200 7350 50  0000 C CNN
	1    15200 7350
	1    0    0    -1  
$EndComp
$Comp
L PNP Q?
U 1 1 4E98EDF5
P 14750 7650
F 0 "Q?" H 14750 7500 60  0000 R CNN
F 1 "PNP" H 14750 7800 60  0000 R CNN
	1    14750 7650
	-1   0    0    1   
$EndComp
$Sheet
S 14700 4150 550  1050
U 4E98ECA0
F0 "INJ3" 60
F1 "InjectorDriver.sch" 60
F2 "INJGND" I L 14700 4300 60 
F3 "INJ" I L 14700 4450 60 
F4 "FB" I L 14700 4600 60 
F5 "GND" I L 14700 4750 60 
F6 "VCC" I L 14700 4900 60 
F7 "IN" I L 14700 5050 60 
$EndSheet
Text Label 14300 4750 0    60   ~ 0
GND
Text Label 14300 4900 0    60   ~ 0
5V
Text Label 14300 5050 0    60   ~ 0
sig3
Text Label 14300 4300 0    60   ~ 0
BIGGND
Text Label 14300 4450 0    60   ~ 0
INJ3
Text Label 14300 4600 0    60   ~ 0
FB
Text Label 14300 6000 0    60   ~ 0
FB
Text Label 14300 5850 0    60   ~ 0
INJ4
Text Label 14300 5700 0    60   ~ 0
BIGGND
Text Label 14300 6450 0    60   ~ 0
sig4
Text Label 14300 6300 0    60   ~ 0
5V
Text Label 14300 6150 0    60   ~ 0
GND
$Sheet
S 14700 5550 550  1050
U 4E98EC9F
F0 "INJ4" 60
F1 "InjectorDriver.sch" 60
F2 "INJGND" I L 14700 5700 60 
F3 "INJ" I L 14700 5850 60 
F4 "FB" I L 14700 6000 60 
F5 "GND" I L 14700 6150 60 
F6 "VCC" I L 14700 6300 60 
F7 "IN" I L 14700 6450 60 
$EndSheet
$Sheet
S 14700 2750 550  1050
U 4E98EC15
F0 "INJ2" 60
F1 "InjectorDriver.sch" 60
F2 "INJGND" I L 14700 2900 60 
F3 "INJ" I L 14700 3050 60 
F4 "FB" I L 14700 3200 60 
F5 "GND" I L 14700 3350 60 
F6 "VCC" I L 14700 3500 60 
F7 "IN" I L 14700 3650 60 
$EndSheet
Text Label 14300 3350 0    60   ~ 0
GND
Text Label 14300 3500 0    60   ~ 0
5V
Text Label 14300 3650 0    60   ~ 0
sig2
Text Label 14300 2900 0    60   ~ 0
BIGGND
Text Label 14300 3050 0    60   ~ 0
INJ2
Text Label 14300 3200 0    60   ~ 0
FB
Text Label 14300 1800 0    60   ~ 0
FB
Text Label 14300 1650 0    60   ~ 0
INJ1
Text Label 14300 1500 0    60   ~ 0
BIGGND
Text Label 14300 2250 0    60   ~ 0
sig1
Text Label 14300 2100 0    60   ~ 0
5V
Text Label 14300 1950 0    60   ~ 0
GND
$Sheet
S 14700 1350 550  1050
U 4E98DA01
F0 "INJ1" 60
F1 "InjectorDriver.sch" 60
F2 "INJGND" I L 14700 1500 60 
F3 "INJ" I L 14700 1650 60 
F4 "FB" I L 14700 1800 60 
F5 "GND" I L 14700 1950 60 
F6 "VCC" I L 14700 2100 60 
F7 "IN" I L 14700 2250 60 
$EndSheet
Text Label 3950 6400 0    60   ~ 0
KSDI
Text Label 3950 6300 0    60   ~ 0
KSDO
Text Label 4150 9700 0    60   ~ 0
GND
$Comp
L CRYSTAL X1
U 1 1 4E97F0C2
P 4250 9100
F 0 "X1" H 4250 9250 60  0000 C CNN
F 1 "8MHz" H 4250 8950 60  0000 C CNN
	1    4250 9100
	1    0    0    -1  
$EndComp
$Comp
L C C6
U 1 1 4E97F046
P 4550 9500
F 0 "C6" H 4600 9600 50  0000 L CNN
F 1 "C" H 4600 9400 50  0000 L CNN
	1    4550 9500
	-1   0    0    1   
$EndComp
$Comp
L C C5
U 1 1 4E97F033
P 3900 9500
F 0 "C5" H 3950 9600 50  0000 L CNN
F 1 "C" H 3950 9400 50  0000 L CNN
	1    3900 9500
	-1   0    0    1   
$EndComp
Text Label 3950 7000 0    60   ~ 0
KSCLK
Text Label 3950 8200 0    60   ~ 0
AVRCLK
Text Label 3950 7500 0    60   ~ 0
CanRx
Text Label 3950 7400 0    60   ~ 0
CanTx
Text Label 10150 2900 0    60   ~ 0
FuelPressure
Text Label 10150 2800 0    60   ~ 0
KnockReport
Text Label 11050 2600 0    60   ~ 0
5V
$Comp
L R R8
U 1 1 4E97EB9D
P 10600 2600
F 0 "R8" V 10680 2600 50  0000 C CNN
F 1 "R" V 10600 2600 50  0000 C CNN
	1    10600 2600
	0    1    1    0   
$EndComp
Text Label 10550 3100 0    60   ~ 0
12VRAW
$Comp
L R R7
U 1 1 4E97EB45
P 10200 3100
F 0 "R7" V 10280 3100 50  0000 C CNN
F 1 "470" V 10200 3100 50  0000 C CNN
	1    10200 3100
	0    1    1    0   
$EndComp
Text Label 8100 8200 0    60   ~ 0
AVRCLK
$Comp
L R R3
U 1 1 4E97E835
P 8700 8200
F 0 "R3" V 8780 8200 50  0000 C CNN
F 1 "1k" V 8700 8200 50  0000 C CNN
	1    8700 8200
	0    1    1    0   
$EndComp
$Comp
L C C3
U 1 1 4E97E82D
P 9150 8200
F 0 "C3" H 9200 8300 50  0000 L CNN
F 1 "470pF" H 9200 8100 50  0000 L CNN
	1    9150 8200
	0    1    1    0   
$EndComp
$Comp
L R R4
U 1 1 4E97E81D
P 9700 8300
F 0 "R4" V 9780 8300 50  0000 C CNN
F 1 "1M" V 9700 8300 50  0000 C CNN
	1    9700 8300
	0    1    1    0   
$EndComp
Text Label 12850 7500 0    60   ~ 0
KNOCK
$Comp
L C C4
U 1 1 4E97E79E
P 12500 7500
F 0 "C4" H 12550 7600 50  0000 L CNN
F 1 "3.3nF" H 12550 7400 50  0000 L CNN
	1    12500 7500
	0    1    1    0   
$EndComp
$Comp
L R R6
U 1 1 4E97E765
P 12050 7500
F 0 "R6" V 12130 7500 50  0000 C CNN
F 1 "10K" V 12050 7500 50  0000 C CNN
	1    12050 7500
	0    1    1    0   
$EndComp
$Comp
L R R5
U 1 1 4E97E744
P 11550 7600
F 0 "R5" V 11630 7600 50  0000 C CNN
F 1 "10K" V 11550 7600 50  0000 C CNN
	1    11550 7600
	0    1    1    0   
$EndComp
Text Label 11350 8300 0    60   ~ 0
KSDO
Text Label 11350 8200 0    60   ~ 0
KSDI
Text Label 11350 8100 0    60   ~ 0
KSCLK
Text Label 9650 8100 0    60   ~ 0
KCS
Text Label 9650 8000 0    60   ~ 0
WIN
Text Label 9600 7500 0    60   ~ 0
GND
Text Label 12750 7100 0    60   ~ 0
GND
Text Label 9250 6900 0    60   ~ 0
5V
$Comp
L CP1 C1
U 1 1 4E97DA14
P 9250 7400
F 0 "C1" H 9300 7500 50  0000 L CNN
F 1 "CP1" H 9300 7300 50  0000 L CNN
	1    9250 7400
	1    0    0    -1  
$EndComp
$Comp
L CP1 C2
U 1 1 4E97D6D9
P 12200 7100
F 0 "C2" H 12250 7200 50  0000 L CNN
F 1 "CP1" H 12250 7000 50  0000 L CNN
	1    12200 7100
	0    -1   -1   0   
$EndComp
Text Label 8100 2100 0    60   ~ 0
sig3
Text Label 8100 1900 0    60   ~ 0
sig4
Text Label 8100 1800 0    60   ~ 0
sig2
Text Label 8100 1600 0    60   ~ 0
sig1
$Comp
L TPIC8101 U4
U 1 1 4E97A1D4
P 10650 7950
F 0 "U4" H 10300 8650 60  0000 C CNN
F 1 "TPIC8101" H 10450 7450 60  0000 C CNN
	1    10650 7950
	1    0    0    -1  
$EndComp
Text Label 3550 3250 0    60   ~ 0
FuelPressure
Text Label 3550 3550 0    60   ~ 0
VSS
Text Label 3550 3750 0    60   ~ 0
KNOCK
Text Label 3550 4150 0    60   ~ 0
TACH
Text Label 3550 4050 0    60   ~ 0
CRANK
Text Label 3550 3950 0    60   ~ 0
VREF
Text Label 3550 3850 0    60   ~ 0
CAM
Text Label 3550 3650 0    60   ~ 0
CLT
Text Label 3550 3350 0    60   ~ 0
IAT
Text Label 3600 2700 0    60   ~ 0
FAN
Text Label 3550 1600 0    60   ~ 0
CEL
Text Label 1500 3500 0    60   ~ 0
INJ4
Text Label 1500 3400 0    60   ~ 0
INJ3
Text Label 1500 3300 0    60   ~ 0
INJ2
Text Label 1500 3200 0    60   ~ 0
INJ1
Text Label 1500 2500 0    60   ~ 0
FuelPump
Text Label 1500 2400 0    60   ~ 0
IAC
Text Label 1500 2300 0    60   ~ 0
Purge
Text Label 1500 2000 0    60   ~ 0
Clutch
Text Label 1500 1900 0    60   ~ 0
IGN2
Text Label 1500 1800 0    60   ~ 0
IGN1
Text Label 1250 1600 0    60   ~ 0
TPS
Text Label 1500 1300 0    60   ~ 0
BIGGND
Text Label 1500 1500 0    60   ~ 0
GND
Text Label 1500 2600 0    60   ~ 0
12VRAW
Text Label 3550 1400 0    60   ~ 0
12VRAW
Text Label 10150 1150 0    60   ~ 0
12VRAW
Text Label 10150 3800 0    60   ~ 0
TACH
Text Label 10150 3400 0    60   ~ 0
FuelPump
Text Label 10150 2700 0    60   ~ 0
Vref
Text Label 10150 3300 0    60   ~ 0
CRANK
Text Label 10150 2600 0    60   ~ 0
CAM
Text Label 10150 2500 0    60   ~ 0
TPS
Text Label 10150 2100 0    60   ~ 0
MAT
Text Label 10150 1700 0    60   ~ 0
CLT
$Comp
L USMODULE U1
U 1 1 4E967618
P 9100 2850
F 0 "U1" H 8700 4550 60  0000 C CNN
F 1 "USMODULE" H 9350 1000 60  0000 C CNN
F 2 "USMODULE" H 9350 4550 60  0000 C CNN
	1    9100 2850
	1    0    0    -1  
$EndComp
$Comp
L ATMEGA16M1-A IC1
U 1 1 4E965278
P 2700 8000
F 0 "IC1" H 1800 9830 50  0000 L BNN
F 1 "ATMEGA16M1-A" H 3000 6600 50  0000 L BNN
F 2 "TQFP32" H 1950 6650 50  0001 C CNN
	1    2700 8000
	1    0    0    -1  
$EndComp
$Comp
L ECU U2
U 1 1 4E9651F0
P 2500 2750
F 0 "U2" H 2250 4300 60  0000 C CNN
F 1 "ECU" H 3000 700 60  0000 C CNN
F 2 "99MiataConnector" H 2800 4300 60  0000 C CNN
	1    2500 2750
	1    0    0    -1  
$EndComp
$EndSCHEMATC
